<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1">
  <title>QuickCV — Generate</title>
  <style>
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;margin:24px}
    h1{margin-bottom:6px}.muted{color:#666;margin-bottom:18px}
    label{display:block;margin:8px 0 4px;font-weight:600}
    input,textarea,select{width:100%;padding:10px;border:1px solid #ddd;border-radius:8px}
    textarea{min-height:80px}
    .grid{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    .row{display:grid;grid-template-columns:1fr 1fr 1fr 1fr 1fr;gap:8px;margin-top:8px}
    .card{border:1px solid #eee;border-radius:12px;padding:12px;margin:12px 0}
    .actions{margin-top:16px;display:flex;gap:10px;flex-wrap:wrap}
    button{padding:10px 14px;border:0;border-radius:10px;box-shadow:0 2px 10px rgba(0,0,0,.06);cursor:pointer}
    .small{padding:6px 10px;border-radius:8px}

    /* --- Option A: PROFESSIONAL (segmented control) --- */
    .seg-wrap{margin:12px 0 6px}
    .seg{display:inline-flex;gap:0;border:1px solid #d9d9d9;border-radius:12px;overflow:hidden;background:#fff}
    .seg button{
      padding:10px 14px;border:0;background:transparent;cursor:pointer;min-width:100px;
      font-weight:600;color:#333
    }
    .seg button + button{border-left:1px solid #eaeaea}
    .seg button.active{background:#f2f7ff;color:#1f6feb;box-shadow:inset 0 0 0 2px rgba(31,111,235,.15)}
    .hint{color:#777;font-size:12px;margin-top:6px}

    /* --- Option B: PLAYFUL (colored chips) --- */
    .chips{display:flex;gap:10px;flex-wrap:wrap;margin:10px 0 8px}
    .chip{
      display:flex;align-items:center;gap:8px;padding:10px 12px;border-radius:999px;color:#111;
      border:1px solid transparent;cursor:pointer;transition:.15s
    }
    .chip .ico{width:18px;height:18px;border-radius:4px}
    .chip.modern{background:linear-gradient(135deg,#dfe9ff,#e7f1ff)}
    .chip.classic{background:linear-gradient(135deg,#f1f1f1,#fafafa)}
    .chip.compact{background:linear-gradient(135deg,#eafaf1,#f5fff6)}
    .chip.active{border-color:#1f6feb;box-shadow:0 2px 10px rgba(0,0,0,.06)}
    .chip:hover{transform:translateY(-1px)}

    /* --- Existing card grid (kept so you can compare) --- */
    .tpl-grid{display:grid;grid-template-columns:repeat(3,minmax(0,1fr));gap:12px;margin:8px 0 4px}
    label.tpl-card{
      margin:0;border:1px solid #ddd;border-radius:12px;background:#fff;cursor:pointer;
      transition:box-shadow .15s,border-color .15s; padding:12px;
      display:grid;grid-template-columns:22px 1fr 120px;align-items:center;column-gap:12px;
      min-height:84px
    }
    .tpl-card:hover{box-shadow:0 2px 12px rgba(0,0,0,.06)}
    .tpl-card.selected{border-color:#2a72de;box-shadow:0 0 0 3px rgba(42,114,222,.15)}
    .tpl-radio{width:18px;height:18px;accent-color:#2a72de}
    .tpl-meta{display:flex;flex-direction:column;gap:4px}
    .tpl-name{font-weight:700}
    .tpl-desc{color:#666;font-size:12px;line-height:1.35}
    .thumb{justify-self:end;width:120px;height:78px;border:1px solid #e6e6e6;border-radius:8px;padding:6px;display:grid;gap:6px;background:#fff}
    .bar{height:8px;border-radius:4px;background:#ddd}
    .lines{display:grid;gap:4px}
    .line{height:6px;border-radius:3px;background:#e5e5e5}
    .modern .bar{background:#2a72de}
    @media (max-width:900px){.tpl-grid{grid-template-columns:1fr 1fr}}
    @media (max-width:620px){.tpl-grid{grid-template-columns:1fr}; label.tpl-card{grid-template-columns:22px 1fr}}
  </style>
</head>
<body>
  <h1>QuickCV — Generate</h1>
  <div class="muted">Your progress is saved automatically on this device.</div>

  <form id="cv-form" method="post" action="/generate">
    <!-- OPTION A: Professional & Sleek -->
    <label>Template Style — Option A (Professional)</label>
    <div class="seg-wrap">
      <div class="seg" id="seg">
        <button type="button" data-template="classic" class="active">Classic</button>
        <button type="button" data-template="modern">Modern</button>
        <button type="button" data-template="compact">Compact</button>
      </div>
      <div class="hint">Clean segmented control. Click to choose a style.</div>
    </div>

    <!-- OPTION B: Playful & Modern -->
    <label>Template Style — Option B (Playful)</label>
    <div class="chips" id="chips">
      <div class="chip classic" data-template="classic"><div class="ico" style="background:#999"></div>Classic</div>
      <div class="chip modern" data-template="modern"><div class="ico" style="background:#2a72de"></div>Modern</div>
      <div class="chip compact" data-template="compact"><div class="ico" style="background:#2ecc71"></div>Compact</div>
    </div>

    <!-- EXISTING selector (so you can compare all three) -->
    <label>Template Style — Current (Legacy)</label>
    <div class="tpl-grid" id="tpl-grid">
      <label class="tpl-card selected" data-value="classic">
        <input class="tpl-radio" type="radio" name="template" value="classic" checked>
        <div class="tpl-meta">
          <div class="tpl-name">Classic</div>
          <div class="tpl-desc">Formal black &amp; white. Safe for all roles.</div>
        </div>
        <div class="thumb">
          <div class="bar"></div>
          <div class="lines">
            <div class="line" style="width:85%"></div>
            <div class="line" style="width:70%"></div>
            <div class="line" style="width:90%"></div>
          </div>
        </div>
      </label>
      <label class="tpl-card" data-value="modern">
        <input class="tpl-radio" type="radio" name="template" value="modern">
        <div class="tpl-meta">
          <div class="tpl-name">Modern</div>
          <div class="tpl-desc">Clean with a subtle accent header.</div>
        </div>
        <div class="thumb modern">
          <div class="bar"></div>
          <div class="lines">
            <div class="line" style="width:88%"></div>
            <div class="line" style="width:76%"></div>
            <div class="line" style="width:92%"></div>
          </div>
        </div>
      </label>
      <label class="tpl-card" data-value="compact">
        <input class="tpl-radio" type="radio" name="template" value="compact">
        <div class="tpl-meta">
          <div class="tpl-name">Compact</div>
          <div class="tpl-desc">Tight, minimal, fits more on one page.</div>
        </div>
        <div class="thumb">
          <div class="bar" style="width:60%"></div>
          <div class="lines">
            <div class="line" style="width:65%"></div>
            <div class="line" style="width:55%"></div>
            <div class="line" style="width:80%"></div>
          </div>
        </div>
      </label>
    </div>

    <div class="grid">
      <div><label>Name</label><input name="name" placeholder="Alex Johnson" required></div>
      <div><label>Role</label><input name="role" placeholder="Junior Web Developer"></div>
    </div>
    <div class="grid">
      <div><label>Location</label><input name="location" placeholder="Leeds, UK"></div>
      <div><label>Email</label><input name="email" placeholder="alex@example.com"></div>
    </div>
    <div class="grid">
      <div><label>Phone</label><input name="phone" placeholder="+44 7123 456 789"></div>
      <div><label>Website</label><input name="website" placeholder="https://yoursite.com"></div>
    </div>

    <label>Profile Summary</label>
    <textarea name="summary" placeholder="2–4 lines about you."></textarea>

    <label>Skills (comma-separated)</label>
    <input name="skills" placeholder="HTML, CSS, JavaScript, React, Git">

    <div class="card">
      <div class="row" style="grid-template-columns:1fr auto">
        <div><strong>Experience</strong></div>
        <div style="text-align:right"><button type="button" class="small" id="add-exp">+ Add experience</button></div>
      </div>
      <div id="exp-list"></div>
    </div>

    <div class="card">
      <div class="row" style="grid-template-columns:1fr auto">
        <div><strong>Education</strong></div>
        <div style="text-align:right"><button type="button" class="small" id="add-edu">+ Add education</button></div>
      </div>
      <div id="edu-list"></div>
    </div>

    <div class="card">
      <div class="row" style="grid-template-columns:1fr auto">
        <div><strong>Projects</strong></div>
        <div style="text-align:right"><button type="button" class="small" id="add-proj">+ Add project</button></div>
      </div>
      <div id="proj-list"></div>
    </div>

    <div class="grid">
      <div><label>Certifications (comma-separated)</label><input name="certs" placeholder="Google Analytics, AWS CCP"></div>
      <div><label>Awards (comma-separated)</label><input name="awards" placeholder="Student of the Year"></div>
    </div>

    <!-- hidden JSON payloads -->
    <textarea name="experience_json" id="experience_json" hidden></textarea>
    <textarea name="education_json" id="education_json" hidden></textarea>
    <textarea name="projects_json" id="projects_json" hidden></textarea>

    <div class="actions">
      <button type="submit" id="dl-html">Download HTML</button>
      <button type="button" id="dl-pdf">Download PDF</button>
      <button type="button" class="small" id="clear-form">Clear form</button>
    </div>
  </form>

  <!-- templates for dynamic rows -->
  <template id="tpl-exp">
    <div class="row">
      <input placeholder="Title (e.g., Web Developer)" data-k="title">
      <input placeholder="Company" data-k="company">
      <input placeholder="Location" data-k="location">
      <input placeholder="Start (YYYY-MM)" data-k="start">
      <input placeholder="End (YYYY-MM or Present)" data-k="end">
      <div style="grid-column:1/-1"><input placeholder="Highlights (comma-separated)" data-k="highlights"></div>
      <div style="grid-column:1/-1;text-align:right"><button type="button" class="small remove">Remove</button></div>
    </div>
  </template>

  <template id="tpl-edu">
    <div class="row">
      <input placeholder="Qualification" data-k="qualification">
      <input placeholder="Institution" data-k="institution">
      <input placeholder="Start (YYYY)" data-k="start">
      <input placeholder="End (YYYY)" data-k="end">
      <input placeholder="Details" data-k="details" style="grid-column:1/-1">
      <div style="grid-column:1/-1;text-align:right"><button type="button" class="small remove">Remove</button></div>
    </div>
  </template>

  <template id="tpl-proj">
    <div class="row">
      <input placeholder="Name" data-k="name">
      <input placeholder="Link (optional)" data-k="link">
      <input placeholder="Summary" data-k="summary" style="grid-column:1/-1">
      <div style="grid-column:1/-1;text-align:right"><button type="button" class="small remove">Remove</button></div>
    </div>
  </template>

  <script>
    const KEY = "quickcv_form_v1";
    const form = document.getElementById('cv-form');
    const expList = document.getElementById('exp-list');
    const eduList = document.getElementById('edu-list');
    const projList = document.getElementById('proj-list');

    // utility
    function collect(container){
      return Array.from(container.children).map(row => {
        const obj = {};
        row.querySelectorAll('[data-k]').forEach(inp => {
          const k = inp.getAttribute('data-k');
          if(k === 'highlights') obj[k] = inp.value.split(',').map(s=>s.trim()).filter(Boolean);
          else obj[k] = inp.value.trim();
        });
        return obj;
      }).filter(o => Object.values(o).some(v => v));
    }

    // dynamic rows
    function addRow(list, tplId, preset){
      const tpl = document.getElementById(tplId);
      const node = tpl.content.firstElementChild.cloneNode(true);
      node.querySelector('.remove').onclick = () => { node.remove(); saveState(); };
      list.appendChild(node);
      if (preset) {
        node.querySelectorAll('[data-k]').forEach(inp => {
          const k = inp.getAttribute('data-k');
          if (k === 'highlights' && Array.isArray(preset[k])) inp.value = preset[k].join(', ');
          else if (preset[k]) inp.value = preset[k];
        });
      }
      node.querySelectorAll('input').forEach(i => i.addEventListener('input', saveState));
    }

    // template selection helpers
    function setTemplate(val){
      // set radio in legacy grid
      const radio = document.querySelector(`input[name="template"][value="${val}"]`);
      if (radio){ radio.checked = true; }
      markSelectedCard();
      // set UI highlights for Option A + Option B
      document.querySelectorAll('.seg button').forEach(b => b.classList.toggle('active', b.dataset.template===val));
      document.querySelectorAll('.chip').forEach(c => c.classList.toggle('active', c.dataset.template===val));
      saveState();
    }
    function currentTemplate(){
      const r = document.querySelector('input[name="template"]:checked');
      return r ? r.value : "classic";
    }
    function markSelectedCard(){
      document.querySelectorAll('.tpl-card').forEach(card => card.classList.remove('selected'));
      const val = currentTemplate();
      const card = document.querySelector(`.tpl-card[data-value="${val}"]`);
      if (card) card.classList.add('selected');
    }

    // state
    function saveState(){
      const data = {
        template: currentTemplate(),
        name: form.name.value, role: form.role.value,
        location: form.location.value, email: form.email.value,
        phone: form.phone.value, website: form.website.value,
        summary: form.summary.value, skills: form.skills.value,
        certs: form.certs ? form.certs.value : "", awards: form.awards ? form.awards.value : "",
        experience: collect(expList), education: collect(eduList), projects: collect(projList),
      };
      try { localStorage.setItem(KEY, JSON.stringify(data)); } catch(e){}
    }

    function restoreState(){
      let raw = localStorage.getItem(KEY);
      if(!raw){
        addRow(expList,'tpl-exp'); addRow(eduList,'tpl-edu'); addRow(projList,'tpl-proj');
        setTemplate('classic'); return;
      }
      try {
        const d = JSON.parse(raw);
        ['name','role','location','email','phone','website','summary','skills','certs','awards'].forEach(k=>{
          if(form[k]!==undefined) form[k].value = d[k] || "";
        });
        (d.experience?.length ? d.experience : [{}]).forEach(x=>addRow(expList,'tpl-exp',x));
        (d.education?.length ? d.education : [{}]).forEach(x=>addRow(eduList,'tpl-edu',x));
        (d.projects?.length ? d.projects : [{}]).forEach(x=>addRow(projList,'tpl-proj',x));
        setTemplate(d.template || 'classic');
      } catch(e){
        addRow(expList,'tpl-exp'); addRow(eduList,'tpl-edu'); addRow(projList,'tpl-proj');
        setTemplate('classic');
      }
    }

    // wire up clicks
    document.getElementById('seg').addEventListener('click', (e)=>{
      if(e.target.closest('button')){
        setTemplate(e.target.closest('button').dataset.template);
      }
    });
    document.getElementById('chips').addEventListener('click', (e)=>{
      const chip = e.target.closest('.chip'); if(!chip) return;
      setTemplate(chip.dataset.template);
    });
    document.getElementById('tpl-grid').addEventListener('change', ()=>{
      setTemplate(currentTemplate());
    });
    document.querySelectorAll('.tpl-card').forEach(card=>{
      card.addEventListener('click', ()=>{
        const input = card.querySelector('input[type="radio"]');
        if (input){ input.checked = true; setTemplate(input.value); }
      });
    });

    // hidden JSON before submit + common buttons
    function syncHiddenJSON(){
      document.getElementById('experience_json').value = JSON.stringify(collect(expList));
      document.getElementById('education_json').value = JSON.stringify(collect(eduList));
      document.getElementById('projects_json').value = JSON.stringify(collect(projList));
    }
    document.getElementById('add-exp').onclick = () => { addRow(expList, 'tpl-exp'); saveState(); };
    document.getElementById('add-edu').onclick = () => { addRow(eduList, 'tpl-edu'); saveState(); };
    document.getElementById('add-proj').onclick = () => { addRow(projList, 'tpl-proj'); saveState(); };
    form.addEventListener('input', saveState);
    form.addEventListener('submit', () => { syncHiddenJSON(); saveState(); });
    document.getElementById('dl-html').addEventListener('click', () => { form.action="/generate"; });
    document.getElementById('dl-pdf').addEventListener('click', () => {
      syncHiddenJSON(); saveState(); form.action="/generate_pdf"; form.submit();
    });
    document.getElementById('clear-form').addEventListener('click', () => { localStorage.removeItem(KEY); location.reload(); });

    restoreState();
  </script>
</body>
</html>
